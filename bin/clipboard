#! /bin/zsh

zmodload zsh/zselect

clipboard-put () {
  print -rn -- $* | case $OSTYPE in
    (cygwin) > /dev/clipboard ;;
    (darwin*) pbcopy ;;
    (*) xclip ;;
  esac
}

clipboard-get () {
  case $OSTYPE in
    (cygwin) cat /dev/clipboard ;;
    (darwin*) pbpaste ;;
    (*) xclip -o ;;
  esac
}

if (( $# > 0 )); then
  clipboard-put $*
elif zselect -t 0 -r 0; then
  local input=
  IFS= read -d $'\0' -r input
  clipboard-put $input
else
  clipboard-get
fi
