(eval-after-load 'evil
  '(evil-define-key 'normal diff-mode-map "q" 'close-buffer-and-window-unless-last))
