emulate -L zsh
setopt extendedglob

if (( $# == 0 )); then
  declare -a existing_dirs
  for dir in $dirstack; do
    if [[ -d $dir ]]; then
      existing_dirs+=$dir
    fi
  done
  dirstack=($existing_dirs)
else
  dirstack=(${dirstack:#$~1})
fi
